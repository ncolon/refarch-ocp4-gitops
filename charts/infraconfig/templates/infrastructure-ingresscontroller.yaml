apiVersion: batch/v1
kind: Job
metadata:
  name: ingresscontroller-config
  namespace: tools
spec:
  template:
    spec:
      containers:
        - name: config
          image: quay.io/openshift/origin-cli:latest
          command: ["oc"]
          args:
            - patch
            - -n
            - openshift-ingress-operator
            - ingresscontroller.operator.openshift.io/default
            - --type=merge
            - -p
            - '{"spec": {"replicas": {{ .Values.ingress.replicas | int }}, "nodePlacement": {"nodeSelector": {"matchLabels": {"node-role.kubernetes.io/infra": ""}},"tolerations": [{"effect":"NoSchedule","key": "infra","value": "reserved"},{"effect":"NoExecute","key": "infra","value": "reserved"}]}}}'
      restartPolicy: Never
      serviceAccountName: argocd-server
  backoffLimit: 4
